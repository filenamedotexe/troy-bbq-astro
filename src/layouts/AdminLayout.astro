---
import BaseLayout from './BaseLayout.astro';

export interface Props {
  title: string;
}

const { title } = Astro.props;
---

<BaseLayout title={title}>
  <div class="min-h-screen bg-gray-50">
    <!-- Admin Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-4">
          <div class="flex items-center space-x-4">
            <h1 class="text-2xl font-bold text-gray-900">Troy BBQ Admin</h1>
            <nav class="flex space-x-4">
              <a
                href="/admin/products"
                class="text-gray-600 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium"
              >
                Products
              </a>
              <a
                href="/admin/categories"
                class="text-gray-600 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium"
              >
                Categories
              </a>
              <a
                href="/admin/settings"
                class="text-gray-600 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium"
              >
                Settings
              </a>
              <a
                href="/admin/quotes"
                class="text-gray-600 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium"
              >
                Quotes
              </a>
              <a
                href="/admin/catering-addons"
                class="text-gray-600 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium"
              >
                Catering Add-ons
              </a>
            </nav>
          </div>
          
          <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-600">its.zach.w@gmail.com</span>
            <button
              id="logoutButton"
              class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors"
            >
              Logout
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="py-8">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <slot />
      </div>
    </main>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const logoutButton = document.getElementById('logoutButton') as HTMLButtonElement;
      
      logoutButton.addEventListener('click', async function() {
        try {
          const response = await fetch('/api/admin/auth?action=logout', {
            method: 'POST'
          });
          
          const result = await response.json();
          
          if (result.success) {
            window.location.href = result.redirectUrl || '/admin/login';
          } else {
            // Fallback to GET request for logout
            window.location.href = '/api/admin/auth?action=logout';
          }
        } catch (error) {
          console.error('Logout error:', error);
          // Fallback to GET request for logout
          window.location.href = '/api/admin/auth?action=logout';
        }
      });

      // Highlight current page in navigation
      const currentPath = window.location.pathname;
      const navLinks = document.querySelectorAll('nav a');
      
      navLinks.forEach(link => {
        const href = link.getAttribute('href');
        if (href && currentPath === href) {
          link.classList.remove('text-gray-600', 'hover:text-orange-600');
          link.classList.add('text-orange-600', 'bg-orange-50');
        }
      });
    });
  </script>
</BaseLayout>