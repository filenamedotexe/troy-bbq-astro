---
import BaseLayout from '../../layouts/BaseLayout.astro';
import OrderTrackerWrapper from '../../components/orders/OrderTrackerWrapper.astro';

// Get the order ID from the URL parameters
const { orderId } = Astro.params;

if (!orderId) {
  return new Response(null, {
    status: 404,
    statusText: 'Order ID not provided'
  });
}

// In a real implementation, you might want to validate the order ID format
// and check if the order exists before rendering the page
const isValidOrderId = /^[a-zA-Z0-9_-]+$/.test(orderId);

if (!isValidOrderId) {
  return new Response(null, {
    status: 400,
    statusText: 'Invalid order ID format'
  });
}
---

<BaseLayout 
  title={`Order ${orderId} - Troy BBQ`}
  description="Track your Troy BBQ order in real-time with detailed status updates and estimated delivery times."
>
  <main class="min-h-screen bg-gray-50 py-8">
    <div class="container mx-auto px-4 max-w-4xl">
      <!-- Page Header -->
      <div class="mb-8">
        <div class="flex items-center gap-4 mb-4">
          <a 
            href="/orders/track" 
            class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 transition-colors"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Search
          </a>
        </div>
        
        <h1 class="text-3xl font-bold text-gray-900 mb-2">
          Order Details
        </h1>
        <p class="text-gray-600">
          Real-time tracking for order {orderId}
        </p>
      </div>

      <!-- Order Tracker Component -->
      <OrderTrackerWrapper orderId={orderId} />

      <!-- Help Section -->
      <div class="mt-12 bg-white rounded-lg shadow-sm p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Need Help with Your Order?</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h3 class="font-medium text-gray-900 mb-2">Contact Us</h3>
            <div class="space-y-2 text-sm">
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                </svg>
                <a href="tel:+15125551234" class="text-blue-600 hover:text-blue-700">(512) 555-1234</a>
              </div>
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
                <a href="mailto:support@troybbq.com" class="text-blue-600 hover:text-blue-700">support@troybbq.com</a>
              </div>
            </div>
          </div>

          <div>
            <h3 class="font-medium text-gray-900 mb-2">Common Questions</h3>
            <div class="space-y-2 text-sm text-gray-600">
              <p>• Order modifications can be made up to 15 minutes after placing</p>
              <p>• Delivery estimates may vary based on current demand</p>
              <p>• You'll receive notifications at each major status change</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Order Actions -->
      <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-center">
        <a 
          href="/menu" 
          class="inline-flex items-center justify-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
        >
          Order Again
        </a>
        <a 
          href="/orders/track" 
          class="inline-flex items-center justify-center px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
        >
          Track Another Order
        </a>
      </div>
    </div>
  </main>

  <!-- Page-specific functionality -->
  <script define:vars={{ orderId }}>
    // Add order-specific JavaScript functionality
    document.addEventListener('DOMContentLoaded', () => {
      // Add order ID to the page context for analytics or other tracking
      if (window.analytics) {
        window.analytics.track('Order Page Viewed', {
          orderId: orderId,
          timestamp: new Date().toISOString()
        });
      }

      // Add keyboard shortcuts for this page
      document.addEventListener('keydown', (e) => {
        // 'R' key to refresh order status
        if (e.key === 'r' || e.key === 'R') {
          e.preventDefault();
          window.dispatchEvent(new CustomEvent('refreshOrder', { detail: { orderId } }));
        }
      });

      // Set up page visibility API to refresh when user returns to tab
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden) {
          // Refresh order data when user returns to the tab
          window.dispatchEvent(new CustomEvent('refreshOrder', { detail: { orderId } }));
        }
      });
    });
  </script>

  <style>
    /* Page-specific styles */
    .container {
      max-width: 1024px;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .container {
        padding-left: 1rem;
        padding-right: 1rem;
      }
    }

    /* Print styles for order details */
    @media print {
      .no-print {
        display: none !important;
      }
      
      main {
        background: white !important;
        padding: 0 !important;
      }
      
      .shadow-sm {
        box-shadow: none !important;
      }
    }
  </style>
</BaseLayout>